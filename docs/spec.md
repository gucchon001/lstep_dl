# 機能仕様書

## 概要
本システムは、LINE公式アカウントの管理画面から会員データとアンケートデータを自動的にダウンロードし、指定されたGoogleスプレッドシートに転記するシステムです。

## 主要機能

### 1. ログイン処理
- LINE公式アカウント管理画面への自動ログイン
- セッション管理とエラー処理
- 認証情報の安全な管理

### 2. データ取得
- 会員データのCSVダウンロード
  - チェックボックスによる項目選択
  - タグによるフィルタリング
  - Shadow DOM要素の操作
- アンケートデータのCSVダウンロード
  - 最新データの自動検出
  - ダウンロード状態の監視

### 3. データ転記
- Googleスプレッドシートへの自動転記
- データ形式の変換と整形
- エラー時のロールバック処理

### 4. ログ管理
- 操作ログの記録
- エラー情報の詳細記録
- デバッグ情報の自動保存

## 技術要件

### ブラウザ自動操作
- Selenium WebDriverを使用
- Chrome ブラウザを制御
- Shadow DOM要素の操作
  - 動的コンポーネントの待機
  - 要素の検索と操作
  - エラー時の代替手段
- 要素の待機処理
  - 明示的待機（WebDriverWait）
  - 動的要素の状態確認
  - タイムアウト制御
- エラーハンドリング
  - 要素取得失敗時の再試行
  - エラー状態からの復帰
  - デバッグ情報の自動保存

### データ処理
- CSVファイルの読み込みと解析
- データ形式の変換
- 文字コードの適切な処理
- 一時ファイルの管理

### API連携
- Google Sheets APIの利用
- OAuth2.0認証
- バッチ処理による効率化
- エラー時のリトライ処理

### セレクタ管理
- CSV形式でのセレクタ定義
- 複数の要素タイプに対応
  - CSS Selector
  - XPath
  - ID/Name
- Shadow DOM要素の特殊処理
- エラー時の代替セレクタ

## 設定項目

### 環境設定
- ログインURL
- ダウンロードURL
- APIキー
- 認証情報

### 実行設定
- 待機時間
- リトライ回数
- タイムアウト値
- ログレベル

### データ設定
- スプレッドシートID
- シート名
- 転記範囲
- データ形式

## エラー処理

### 想定エラー
- ネットワークエラー
- 認証エラー
- 要素取得エラー
- ファイル操作エラー
- API通信エラー

### エラー対応
- エラーメッセージの詳細記録
- リトライ処理の実装
- エラー状態からの復帰
- 運用者への通知

## 運用要件

### 実行環境
- Windows 10以上
- Python 3.7以上
- Chrome ブラウザ最新版
- インターネット接続必須

### メンテナンス
- ログファイルの定期清掃
- 一時ファイルの削除
- セレクタの更新確認
- ブラウザの更新対応